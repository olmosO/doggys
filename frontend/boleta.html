<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Doggy's - Boleta y Seguimiento</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="styles.css">
  <style>
    /* Estilos extra para el seguimiento */
    .step-active {
        background-color: #d1e7dd; /* Verde claro bootstrap */
        font-weight: bold;
        color: #0f5132;
    }
    .badge-status {
        width: 15px; height: 15px; display: inline-block; border-radius: 50%;
    }
  </style>
</head>
<body>

<script>
  const usuarioId = localStorage.getItem("usuario_id");
  if (!usuarioId) window.location.href = "login.html";
</script>

<nav class="navbar navbar-expand-lg">
  <div class="container">
    <a class="navbar-brand" href="index.html">Doggy's</a>
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarMenu">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarMenu">
      <ul class="navbar-nav ms-auto">
        <li class="nav-item"><a class="nav-link" href="menu.html">MenÃº</a></li>
        <li class="nav-item dropdown" id="admin-panel" style="display:none;">
          <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown">Panel Admin</a>
          <ul class="dropdown-menu">
            <li><a class="dropdown-item" href="dashboard_productos.html">GestiÃ³n Productos</a></li>
            <li><a class="dropdown-item" href="reportes.html">Reportes Ventas</a></li>
          </ul>
        </li>
        <li class="nav-item"><a class="nav-link" id="perfil-link" href="perfil.html" style="display:none;">Mi Perfil</a></li>
        <li class="nav-item"><a class="nav-link text-warning" id="logout-link" href="#">Cerrar SesiÃ³n</a></li>
      </ul>
    </div>
  </div>
</nav>

<div class="container-main">
  <div class="container mt-5">

    <div class="row">
      <div class="col-lg-7">
        <h2 class="mb-4">Boleta ElectrÃ³nica</h2>

        <div class="card p-4 shadow-sm mb-4">
            <div class="mb-3">
              <strong>NÃºmero de Boleta: </strong><span id="numBoleta">--</span><br>
              <strong>Fecha: </strong><span id="fechaBoleta">--</span><br>
            </div>

            <h4>Datos del Cliente</h4>
            <div class="row mb-3">
              <div class="col-md-6">
                <label class="form-label">Nombre</label>
                <input type="text" id="nombreCliente" class="form-control" readonly>
              </div>
              <div class="col-md-6">
                <label class="form-label">Correo</label>
                <input type="email" id="correoCliente" class="form-control" readonly>
              </div>
            </div>

            <h4>Detalle de la Compra</h4>
            <table class="table table-striped" id="tablaPedido">
              <thead>
                <tr>
                  <th>Producto</th>
                  <th>Cant.</th>
                  <th>Precio</th>
                  <th>Subtotal</th>
                </tr>
              </thead>
              <tbody></tbody>
            </table>

            <div class="mt-2 text-end">
              <h4>Total: $<span id="totalPedido">0</span></h4>
            </div>

            <div class="mt-4">
               <button id="btnGenerar" class="btn btn-primary w-100">Confirmar y Generar Boleta</button>
            </div>
            
            <div class="mt-3">
              <div id="mensajeExito" class="alert alert-success d-none"></div>
              <div id="mensajeError" class="alert alert-danger d-none"></div>
            </div>
        </div>
      </div>

      <div class="col-lg-5">
        <h2 class="mb-4">Seguimiento</h2>
        
        <div class="card p-4 shadow-sm" id="panelSeguimiento" style="opacity: 0.5; pointer-events: none;">
            <p class="text-muted small">El seguimiento comenzarÃ¡ una vez generes la boleta.</p>
            
            <ul class="list-group" id="listaEstados">
              <li class="list-group-item d-flex justify-content-between align-items-center" id="step-pendiente">
                1. Recibido
                <span class="badge-status bg-secondary"></span>
              </li>
              <li class="list-group-item d-flex justify-content-between align-items-center" id="step-pagado">
                2. Pagado
                <span class="badge-status bg-secondary"></span>
              </li>
              <li class="list-group-item d-flex justify-content-between align-items-center" id="step-preparacion">
                3. En preparaciÃ³n
                <span class="badge-status bg-secondary"></span>
              </li>
              <li class="list-group-item d-flex justify-content-between align-items-center" id="step-camino">
                4. En camino
                <span class="badge-status bg-secondary"></span>
              </li>
              <li class="list-group-item d-flex justify-content-between align-items-center" id="step-entregado">
                5. Entregado
                <span class="badge-status bg-secondary"></span>
              </li>
            </ul>

            <div id="msgEntrega" class="alert alert-success mt-3 d-none text-center">
                Â¡Tu pedido ha llegado! ðŸŒ­ðŸ›µ
            </div>
        </div>
      </div>
    </div>

  </div>
</div>

<footer>
  <div class="footer-content text-center py-3">
    <p>Â© 2025 Doggyâ€™s â€” Todos los derechos reservados.</p>
  </div>
</footer>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script src="js/boleta.js"></script>
<script src="inactividad.js"></script>

<script>
document.addEventListener("DOMContentLoaded", () => {
    const usuarioId = localStorage.getItem('usuario_id');
    const isAdmin = localStorage.getItem('is_admin') === 'true';
    const adminPanel = document.getElementById("admin-panel");
    const perfilLink = document.getElementById("perfil-link");
    const logoutLink = document.getElementById("logout-link");

    if (usuarioId) {
        if(isAdmin) {
            if(adminPanel) adminPanel.style.display = "block";
        } else {
            if(perfilLink) perfilLink.style.display = "block";
        }
        if(logoutLink) {
            logoutLink.addEventListener("click", () => {
                localStorage.clear();
                window.location.href = "index.html";
            });
        }
    }
});
</script>

<script>
// Esta funciÃ³n se llamarÃ¡ desde boleta.js cuando la boleta sea exitosa
window.iniciarSimulacionPedido = function() {
    const panel = document.getElementById("panelSeguimiento");
    panel.style.opacity = "1"; // Habilitar visualmente
    
    const estados = ["pendiente", "pagado", "preparacion", "camino", "entregado"];
    let indice = 0;

    // FunciÃ³n para actualizar un paso
    const avanzarPaso = () => {
        if (indice >= estados.length) {
            document.getElementById("msgEntrega").classList.remove("d-none");
            return; 
        }

        const estadoActual = estados[indice];
        const li = document.getElementById(`step-${estadoActual}`);
        const badge = li.querySelector(".badge-status");

        // Estilo activo
        li.classList.add("step-active");
        badge.classList.remove("bg-secondary");
        badge.classList.add("bg-success");

        indice++;
        
        // Programar el siguiente paso en 4 segundos
        setTimeout(avanzarPaso, 4000);
    };

    // Iniciar el primer paso inmediatamente
    avanzarPaso();
};
</script>

</body>
</html>